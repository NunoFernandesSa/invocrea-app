generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String    @id // clerk id
  name      String?
  email     String    @unique
  createdAt DateTime  @default(now())
  updatedAt DateTime? @updatedAt

  invoices Invoice[] @relation("UserInvoices")
  clients  Client[]  @relation("UserClients")

  @@map("users")
}

model Invoice {
  id            String        @id
  name          String
  issuerName    String        @default("")
  issuerAddress String        @default("")
  clientName    String        @default("")
  clientAddress String        @default("")
  invoiceDate   String        @default("")
  dueDate       String        @default("")
  vatActive     Boolean       @default(false)
  vatRate       Float         @default(20)
  status        Int           @default(1) // Brouillon = 1, Envoyée = 2, En attente = 3, Validée = 4, Payée = 5 , Annulée = 6, Impayée = 7
  createdAt     DateTime      @default(now())
  updatedAt     DateTime?     @updatedAt
  lines         InvoiceLine[] @relation("InvoiceLines")

  userId      String
  createdById User   @relation("UserInvoices", fields: [userId], references: [id], onDelete: Cascade)

  clientId String?
  client   Client? @relation("ClientInvoices", fields: [clientId], references: [id], onDelete: SetNull) // SetNull car c'est optionnel

  @@map("invoices")
}

model InvoiceLine {
  id          String    @id @default(cuid())
  description String    @default("")
  quantity    Int       @default(0)
  unitPrice   Float     @default(0)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime? @updatedAt

  invoiceId String?
  invoice   Invoice? @relation("InvoiceLines", fields: [invoiceId], references: [id])

  @@map("invoice_lines")
}

model Client {
  id        String    @id @default(cuid())
  name      String
  email     String    @unique
  address   String    @default("")
  phone     String    @default("")
  siret     String    @default("")
  createdAt DateTime  @default(now())
  updatedAt DateTime? @updatedAt

  invoices Invoice[] @relation("ClientInvoices")
  userId   String
  user     User      @relation("UserClients", fields: [userId], references: [id])

  @@map("clients")
}
